generator client {
  provider = "prisma-client-js"
  output   = "./src/generated/prisma"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  user
  admin
}

model user {
  id               String    @id @default(uuid())
  email            String    @unique
  password         String    
  name             String
  role             Role      @default(user)
  createdAt        DateTime  @default(now())
  documents_to_pay Int @default(3)

  generatedDocuments generated_document[]
}

model document_template {
  id        String           @id @default(uuid())
  name      String           @unique
  createdAt DateTime         @default(now())
  content   String          

  fields    document_field[]
  generatedDocuments generated_document[]
}

model generated_document {
  id         String    @id @default(uuid())
  name       String
  userId     String
  templateId String
  content    String    
  createdAt  DateTime  @default(now())

  user      user              @relation(fields: [userId], references: [id])
  template  document_template @relation(fields: [templateId], references: [id])
  fieldValues generated_document_field_value[]
}

model document_field {
  id          String           @id @default(uuid())
  templateId  String
  name        String          
  label       String          
  type        String          
  required    Boolean          @default(true)

  template    document_template @relation(fields: [templateId], references: [id])
  values      generated_document_field_value[]
}

model generated_document_field_value {
  id          String    @id @default(uuid())
  documentId  String
  fieldId     String
  value       Json      

  document    generated_document @relation(fields: [documentId], references: [id])
  field       document_field     @relation(fields: [fieldId], references: [id])
}
